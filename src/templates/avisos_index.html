{% extends "base.html" %}
{% block content %}

<div class="row">
    <div class="col-lg-12 text-center">
        <h1>Avisos <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span></h1>
    </div>
</div>
<br/>
<a class="btn btn-primary" href="/create">
    Crear Aviso
    <span style="margin-left: 5px;" class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
</a>
<br/>
<br/>

<!--TODO Insert you key for run map ;) Generated by SecurityExportToGithub.kt -->
<script src="https://maps.googleapis.com/maps/api/js?key=INSERT_YOU_KEY"
  		type="text/javascript"></script>
<script>
var map;
function init_map(latlngPos){
    var myOptions = {
      zoom: 15,
      center: latlngPos,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
      
      // Define the map
    map = new google.maps.Map(document.getElementById("map-container"), myOptions);
}

function isRealValue(obj)
{
 	return obj && obj !== 'null' && obj !== 'undefined';
}

function addMarker(dire){
    var userLocation = dire;
    var geocoder = new google.maps.Geocoder();
    var lat;
    var lng;
    var place;
    geocoder.geocode({
        address: userLocation
    }, function(locResult) {
        console.log(locResult);
        lat = locResult[0].geometry.location.lat();
        lng = locResult[0].geometry.location.lng();
        var latitude = parseFloat(lat);
        var longitude = parseFloat(lng);
       
        var latlngPos = new google.maps.LatLng(latitude, longitude);

		if (!isRealValue(map)){
	 		init_map(latlngPos);
		}

        var var_marker = new google.maps.Marker({
                			position: latlngPos,
                			map: map,
                			title:'Aviso'});

        var_marker.setMap(map);
    });
}
</script>
{% if avisos.count() > 0 %}
<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <table class="table">
            <thead>
            <th>Calle</th>
            <th>Numero</th>
            <th>Código postal</th>
            <th>Fecha</th>
            <th>Hora</th>
            </thead>
            <tbody>
            {% for aviso in avisos %}
            <tr>
                <td>{{aviso.calle}}</td>
                <td>{{aviso.numero}}</td>
                <td>{{aviso.cod_postal }}</a></td>
				<td>{{aviso.date.strftime('%Y-%m-%d')}}</td>
				<td>{{aviso.date.strftime('%H:%M')}}</td>
				<td><a class="btn btn-warning" href="/show/{{aviso.key().id()}}">Ver Aviso</td>
                <td><a class="btn btn-warning" href="/edit/{{ aviso.key().id() }}">Editar</a></td>
                <td><a class="btn btn-warning" href="/delete/{{ aviso.key().id() }}">Eliminar</a></td>
            </tr><script>addMarker('{% print "%s, %s ,%s"% (aviso.cod_postal,aviso.calle,aviso.numero) %}');</script>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="map-container"  style="width:100%;height:25em;"></div>
    <div class="col-md-2"></div>
</div>

{% else %}
<div class="row">
    <div class="col-lg-12 text-center">
        <div class="col-md-3"></div>
        <div class="col-md-6 bg-warning warning_mesagge">
            <label>No existen Avisos aún</label>
        </div>
        <div class="col-md-3"></div>

    </div>
</div>

{% endif %}
<script type="text/javascript">
            window.onload = function() {
                if(!window.location.hash) {
                    window.location = window.location + '#loaded';
                    window.location.reload();
                }
            }
        </script>
{% endblock content %}
